---
title: DEV Flightcomputer V1.0
date: 2024-12-31 12:00:00 -500
categories: [hardware, review]
tags: [hardware, review, pcbdesign, flightcomputer]

author: <author_id>                     # for single entry
# or
# authors: [<author1_id>, <author2_id>]   # for multiple entries

description: a blogpost for the review.

toc: true #table of content variable turned off for specific post, globally in _config.yml

#comments: false # The global setting for comments is defined by the comments.provider option in the _config.yml file. Once a comment system is selected for this variable, comments will be enabled for all posts.If you want to close the comment for a specific post, add the following to the Front Matter of the post:

# media_subpath: /path/to/media/ # To specify the resource path prefix for the current post/page range, set media_subpath in the front matter of the post

image:
  path: /assets/feza/pictures/feza_fcu_pcb-removebg.png
  #alt: image alternative text # If you want to add an image at the top of the post, please provide an image with a resolution of 1200 x 630. Please note that if the image aspect ratio does not meet 1.91 : 1, the image will be scaled and cropped. Knowing these prerequisites, you can start setting the image’s attribute

#image: /assets/img/pcbpost/feza_fcu_pcb-removebg.png #For simple use, you can also just use image to define the path.

pin: true # You can pin one or more posts to the top of the home page, and the fixed posts are sorted in reverse order according to their release date. Enable by:

#math: true # We use MathJax to generate mathematics. For website performance reasons, the mathematical feature won’t be loaded by default. But it can be enabled by

#mermaid: true # Mermaid is a great diagram generation tool. To enable it on your post, add the following to the YAML block:

---

> * You can easlily navigate through the Contents Navigation Bar on the right side.
{: .prompt-info }


## Introduction

### About me
I am a former car mechatronic technician and car wrapper, currently a mechanical engineer who started this project to create a learning platform for the next 5-10 years. My goal is to evolve into a general engineer or a full-stack engineer. The main purpose of this project is to learn Electrical Engineering in the first stage, followed by Physics, Math, Control Algorithms, Software Development, Robotics (e.g., Sensor Fusion, Thrust Vector Control, Reaction Wheel), and many more fields of engineering in the later stages.

### The PCB
The main purpose of this PCB is to serve as the primary development platform to learn all these interesting fields and act as a general-purpose computer. It could be used as a model rocket, fixed-wing or multicopter flight computer, or literally any kind of robot. Due to the CAN bus capability, it is possible to design dedicated task-focused PCBs and use this board as the central brain of the system. Surely, there will be iterations if flaws and hardware limitations are noticed during further development. I'm sure there are better ways of designing a board like this, but I want to mention that I'm not an electrical engineer, and this is the best I could achieve based on my current knowledge gained during the last ~200 hours of schematic design. A lot of this schematic is designed by referencing other schematics and trying to understand the reasoning by looking at the specific datasheets of the used components and asking relevant questions in subreddits like r/PrintedCircuitBoards, r/AskElectronics, r/Robotics, r/Electronics, and r/Arduino. The main reference is the Hades flight computer from Phil's Lab, and the peripherals are kind of mixed references from Reddit, Adafruit, SparkFun, and so on. The idea of choosing these specific components is that there are already ready-to-use libraries to start developing via PIO, ESP-IDF, and the Arduino Platform because I don't have the ability to write bare-metal programs yet. This will be important in later stages and will help me learn bare-metal programming by looking at existing libraries and figuring it out.

### Design Choice

#### Powermanagement
This PCB is going to be powered by a LiPo and a switching regulator capable of 5V @ 9 Amps max. This should be sufficient to power at least three servos with a stall current of 2.5-3 Amps; however, the correct amount of servos will be known after doing real measurements. The ESCs are going to be connected to the servo connectors, and they will have their own LiPo. I'm most likely going to design a slave PCB via CAN bus to operate the servos' BLDCs, which have decoders in later stages. The switching regulator part is the most complex topic for me on this schematic and is a 1:1 copy of Phil's Lab Hades flight computer.

There are two LDOs: one for 3.3V logic level (MCU and sensors) and one with 1.8V logic level for the CANSilent level shifter of the CAN transceiver because two pins of the ESP32S3 have 1.8V logic, and only one of them is used; all the others are NC (not connected). There is also an INA219 current sensor.

#### USB-Interface
The USB-Interface is simply a 1:1 copy of the dev board schematics; the only difference is that I used USB-C ports instead of Micro USB and added TX/RX transmission LEDs to the USB-UART converter. I decided to keep the auto programmer logic for development purposes so I can reduce the ESD risks while handling it and create a 3D-printed housing for this PCB.

#### Flight Computer Controller Unit (FCCU)
The FCCU (Flight Computer Controller Unit) serves as the central brain, which will have the main algorithms on it.

* There is an SD card serving as a read/write eMMC to do data logging and, if needed, to save calibration data on it to avoid saving stuff in the internal EEPROM of the ESP.
* Current sensor to monitor battery state.
* The CAN bus serves as an extension slot for task-dedicated slave PCBs.
* There is a buzzer for feedback (battery state, specific states, errors, if it lands somewhere unplanned).
* The LEDs are status LEDs (calibration, communications, etc.).
* 3x10-pin 2.54mm (0.1") servo header (SIG, 5V, GND) for six servos and four BLDCs with external ESCs capable of 5V @ 9 Amps max.
* There is another board-to-wire I2C Molex connector for anything else I might have forgotten.

#### Navigation Computer Controller Unit (NAVCU)
The NAVCU (Navigation Controller Unit) serves as the central brain that communicates with the FCCU via UART and I2C. It handles the computation-heavy sensor fusion and has a lot of peripheral sensors. It is dedicated solely to navigation.

* There is an SD card serving as a read/write eMMC to do data logging and, if needed, to save calibration data on it to avoid saving stuff in the internal EEPROM of the ESP. I chose to put a dedicated SD card slot for the NAVCU during the development stages to log a more detailed log than in the FCCU for further data analytics and error handling. The FCCU will only log mission-critical information, which is also handed over to the ground station computer in later stages.
* CAL_BTN: Simply a calibration button for manual calibration if needed.
* There is an extra SPI board-to-wire Molex connector, which also could be used as an extra four GPIO due to the pin multiplexing nature of the ESP32S3.
* GNSS: The NEO-M9N with an extra board-to-wire Molex connector for dedicated setup via external USB to TTL adapter.
* IMUs: BNO055 9DoF as the primary IMU, BMI088 6DoF as the redundant secondary IMU.
* Magnetometer: IIS2MDCTR 3DoF as a complementary device for the BMI088.
* Temperature Sensor: TMP100 to measure board temperature if there are some issues with heat absorption.
* Barometer: DPS310 barometric pressure sensor to gain information about altitude.

#### Uncertainties
There are a total of fourthings about which I have some uncertainties.
1. Schottky Diodes: Have I placed all six Schottky diodes correctly, and are there any missing? I have placed one Schottky diode for each power source: 4x USB, 1x Switching Regulator, and 1x Hot-Start GNSS external battery connector.
2. ESD Protection: I placed 2x ESD diodes on each SD card slot, 4x ESD arrays for each USB slot, 1x ESD diode on the GNSS antenna, and 1x ESD diode on the CANBUS Molex connector. I don't have ESD diodes on the SPI test point headers, the I²C external connector, the external SPI Molex connector, the boot, reset, and calibration buttons, the safeboot header for the GNSS module, the Molex connector of the GNSS module, or the hot-start battery connector for the GNSS module.
3. Test Points: I'm not sure if the test points are sufficient. I feel like they are, but I'm still unsure about it.
4. F.Mask from the BMI088.



## Schematic

> 
  * If you are inside the PDF-Viewer, you can zoom in/out with CTRL+Mousewheel and also navigation through it with the Mouswheelbutton.
  * In case you prefer to use an external tab for the fullscreen PDF Viewer, you can acces the PDF via the attached link.
{: .prompt-tip }




### Schematic Colored

* [PDF Viewer Fullscreen](https://drive.google.com/file/d/1Y6oI--jDbpzb4Ou7beZpa2FUDnwzTEg1/view?usp=sharing "Schematic colored")

<iframe 
  src="/assets/feza/schematic/color/feza_fcu_pcb.pdf" 
  width="100%" 
  height="500" 
  style="border: none;">
</iframe>

### Schematic Monochromatic

* [PDF Viewer Fullscreen](https://drive.google.com/file/d/1Y6oI--jDbpzb4Ou7beZpa2FUDnwzTEg1/view?usp=sharing "Schematic Monochromatic")

<iframe 
  src="/assets/feza/schematic/monochromatic/feza_fcu_pcb.pdf" 
  width="100%" 
  height="500" 
  style="border: none;">
</iframe>



## Gerbers as SVGs / ZIP

<h3 class="text-center">Layer 1 (SIG)</h3>

![Desktop View](/assets/feza/svgs/feza_fcu_pcb-F_Cu.svg){: w="700" } 




<h3 class="text-center">Layer 2 (GND)</h3>

![Desktop View](/assets/feza/svgs/feza_fcu_pcb-In1_Cu.svg){: w="700" }



<h3 class="text-center">Layer 3 (PWR)</h3>

![Desktop View](/assets/feza/svgs/feza_fcu_pcb-In2_Cu.svg){: w="700" }



<h3 class="text-center">Layer 4 (SIG)</h3>

![Desktop View](/assets/feza/svgs/feza_fcu_pcb-B_Cu.svg){: w="700" }



<h3 class="text-center">Front Mask</h3>

![Desktop View](/assets/feza/svgs/feza_fcu_pcb-F_Mask.svg){: w="700" }

> I added the Front Mask layer into this, because im unsure about the BMI088 masking. It is the first IC when you look left from the testpoint of the middle ESP32(NAVCU). I also didnt know if this is possible to make a correction. 
{: .prompt-warning }




### Gerber Viewer & Download

* [Tracespace.io Gerber-Viewer](https://tracespace.io/view/?boardUrl=https://deficientinvent0r.github.io/assets/feza/manufacturing/fabrication/Gerbers/feza_fcu_pcb.zip "Gerber Viewer")

* [Download Gerbers.zip](/assets/feza/manufacturing/fabrication/Gerbers/feza_fcu_pcb.zip)



## Fabrication Document

* [PDF Viewer Fullscreen](https://drive.google.com/file/d/1Y6oI--jDbpzb4Ou7beZpa2FUDnwzTEg1/view?usp=sharing "Schematic Monochromatic")

<iframe 
  src="/assets/feza/manufacturing/fabrication/Docs/feza_fcu_pcb__Fabrication.pdf" 
  width="100%" 
  height="500" 
  style="border: none;">
</iframe>

## Assembly Document

* [PDF Viewer Fullscreen](https://deficientinvent0r.github.io/assets/feza/manufacturing/assembly/Docs/feza_fcu_pcb__Assembly.pdf "Schematic Monochromatic")

<iframe 
  src="https://docs.google.com/viewer?url=https://deficientinvent0r.github.io/assets/feza/manufacturing/assembly/Docs/feza_fcu_pcb__Assembly.pdf&embedded=true"
  width="100%" 
  height="500" 
  style="border: none;">
</iframe>


<div style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden; max-width: 100%;">
  <iframe src="https://docs.google.com/viewer?url=https://deficientinvent0r.github.io/assets/feza/manufacturing/assembly/Docs/feza_fcu_pcb__Assembly.pdf&embedded=true" 
          style="position: absolute; top: 0; left: 0; width: 100%; height: 100%;" 
          frameborder="0" 
          allowfullscreen>
  </iframe>
</div>


## Bill of Material

### Interactive BOM
>  * In case you prefer to use the fullscreen iBoM, you can acces it via the Settings Gear.
{: .prompt-tip}
<iframe 
  src="/assets/feza/manufacturing/assembly/feza_iBoM.html" 
  width="100%" 
  height="700" 
  style="border: none;">
</iframe>

### Costs

| Item       | Price    | 
|------------|----------|
| Components     | 147,74€  | 
| PCB Manufacturing   | 106,51€  | 
| PCB Assembly   | 29€      | 
| **TOTAL**  | **283,25€**  | 

## Reports

### ERC

### DRC

## Known Issues

## Credits
